<?php


$text1= base64_decode("CgpMb3JlbSBpcHN1bSBkb2xvciBzaXQgYW1ldCwgY29uc2VjdGV0dXIgYWRpcGlzY2luZyBlbGl0LiBQcmFlc2VudCBhdCB0ZWxsdXMgbGliZXJvLiBOdWxsYW0gb2RpbyBtYXVyaXMsIG9ybmFyZSBzZWQgbmlzaSBhYywgcG9zdWVyZSBvcm5hcmUgbGliZXJvLiBTZWQgZGlnbmlzc2ltIGV1aXNtb2QgcHVsdmluYXIuIExvcmVtIGlwc3VtIGRvbG9yIHNpdCBhbWV0LCBjb25zZWN0ZXR1ciBhZGlwaXNjaW5nIGVsaXQuIEN1cmFiaXR1ciBzb2RhbGVzIHN1c2NpcGl0IGV1aXNtb2QuIER1aXMgcG9ydGEgbGFjdXMgc2l0IGFtZXQgdWx0cmljZXMgdHJpc3RpcXVlLiBDcmFzIGV1IGVyYXQgYSBmZWxpcyBzZW1wZXIgdml2ZXJyYSB2aXRhZSBhIGRpYW0uIEV0aWFtIGZldWdpYXQgbWFzc2EgcHJldGl1bSBkaWduaXNzaW0gb3JuYXJlLiBJbiBhY2N1bXNhbiBvZGlvIG5lYyByaXN1cyBzb2xsaWNpdHVkaW4gZGlnbmlzc2ltLiBWZXN0aWJ1bHVtIGF1Z3VlIHJpc3VzLCByaG9uY3VzIGV0IGVyb3MgYWMsIHNhZ2l0dGlzIHZpdmVycmEgZXJhdC4gTmFtIHZpdmVycmEgbmVxdWUgZXJhdCwgaW4gaW1wZXJkaWV0IGVsaXQgdWx0cmljaWVzIG5vbi4gTWF1cmlzIGlkIHNhcGllbiBub24gdHVycGlzIHBvcnRhIHVsdHJpY2VzIHNpdCBhbWV0IG5lYyB2ZWxpdC4gUGVsbGVudGVzcXVlIGhhYml0YW50IG1vcmJpIHRyaXN0aXF1ZSBzZW5lY3R1cyBldCBuZXR1cyBldCBtYWxlc3VhZGEgZmFtZXMgYWMgdHVycGlzIGVnZXN0YXMuCgpJbiBzZWQgZG9sb3Igc2NlbGVyaXNxdWUsIHNvZGFsZXMgbWFzc2Egc2l0IGFtZXQsIHRyaXN0aXF1ZSBsYWN1cy4gUXVpc3F1ZSBjb252YWxsaXMgcGhhcmV0cmEgcXVhbSBhIGFjY3Vtc2FuLiBTdXNwZW5kaXNzZSBwcmV0aXVtIHR1cnBpcyBxdWlzIG1pIHVsdHJpY2VzIGJpYmVuZHVtLiBTZWQgc2FnaXR0aXMgbmlzbCBldCBudW5jIHJob25jdXMsIHV0IGxhY2luaWEgZGlhbSBzY2VsZXJpc3F1ZS4gTmFtIG1heGltdXMgc2FnaXR0aXMgbGVvLCBzaXQgYW1ldCBlZmZpY2l0dXIgbGVvIHVsdHJpY2VzIGEuIEFlbmVhbiBiaWJlbmR1bSBxdWFtIGF0IGxhb3JlZXQgbG9ib3J0aXMuIE51bmMgYmxhbmRpdCBlbmltIGF1Y3RvciBleCBlbGVpZmVuZCB0aW5jaWR1bnQuIENyYXMgbmVjIHRlbGx1cyBzdXNjaXBpdCwgZGlnbmlzc2ltIHB1cnVzIG5lYywgdWx0cmljaWVzIGxlY3R1cy4gTWF1cmlzIGFjIHVybmEgbHVjdHVzLCB0ZW1wb3IgdG9ydG9yIHNlZCwgaW50ZXJkdW0gbWF1cmlzLiBDcmFzIHNpdCBhbWV0IHRlbGx1cyBhdCBwdXJ1cyBlbGVpZmVuZCB2ZWhpY3VsYS4gQWVuZWFuIHZpdGFlIGZhdWNpYnVzIGVyYXQsIGV1IGZyaW5naWxsYSBuZXF1ZS4KClBlbGxlbnRlc3F1ZSBoYWJpdGFudCBtb3JiaSB0cmlzdGlxdWUgc2VuZWN0dXMgZXQgbmV0dXMgZXQgbWFsZXN1YWRhIGZhbWVzIGFjIHR1cnBpcyBlZ2VzdGFzLiBDcmFzIGV0IHNlbSBlZ2V0IG5pc2wgdWx0cmljaWVzIHVsdHJpY2VzIHV0IG5lYyBsaWd1bGEuIE51bGxhIHRpbmNpZHVudCBmZXJtZW50dW0gbGlndWxhIG5lYyBwb3J0YS4gTnVsbGEgcXVpcyB0cmlzdGlxdWUgcmlzdXMuIEZ1c2NlIGxhb3JlZXQgcmlzdXMgbmliaC4gQ3JhcyBpZCBvcmNpIGlkIGxlbyB0aW5jaWR1bnQgbG9ib3J0aXMgaW4gc2VkIHRvcnRvci4gU2VkIG1ldHVzIGlwc3VtLCByaG9uY3VzIGFjIGN1cnN1cyB2aXRhZSwgZmVybWVudHVtIG5vbiBkaWFtLiBGdXNjZSBxdWlzIGVsaXQgc29sbGljaXR1ZGluLCBzY2VsZXJpc3F1ZSBsZWN0dXMgdXQsIHRlbXBvciB1cm5hLgoKQWVuZWFuIGFudGUgbWF1cmlzLCBsYWNpbmlhIHZlbCBxdWFtIGF0LCBjb252YWxsaXMgdGluY2lkdW50IGxhY3VzLiBEb25lYyBhbGlxdWFtIHF1YW0gc2l0IGFtZXQgbGVvIHN1c2NpcGl0LCBub24gYWxpcXVhbSB1cm5hIGFsaXF1YW0uIE1vcmJpIHZlbCBwZWxsZW50ZXNxdWUgbmVxdWUuIFByYWVzZW50IGluIG51bGxhIGFyY3UuIEFsaXF1YW0gbWFsZXN1YWRhIHNlbSBtaSwgZXUgc2NlbGVyaXNxdWUgZXJvcyB0ZW1wb3Igc2VkLiBQZWxsZW50ZXNxdWUgY29uZ3VlIGp1c3RvIGlkIGxvcmVtIHBvcnRhLCBlZ2V0IHRlbXBvciBsZWN0dXMgdHJpc3RpcXVlLiBGdXNjZSBuZWMgZXJvcyBmYWNpbGlzaXMsIHZ1bHB1dGF0ZSBkb2xvciBhLCBjdXJzdXMgbWFnbmEuIEludGVnZXIgaW50ZXJkdW0gc2VtIHNpdCBhbWV0IHByZXRpdW0gbG9ib3J0aXMuIFZlc3RpYnVsdW0gbm9uIGFsaXF1YW0gYXJjdS4gSW4gbWF0dGlzIHRvcnRvciBhdCBlcmF0IGZlcm1lbnR1bSwgaW4gY29uc2VxdWF0IHJpc3VzIGF1Y3Rvci4gTW9yYmkgYWxpcXVldCBlZ2VzdGFzIHRvcnRvciBpbiBmYWNpbGlzaXMuIEluIGhhYyBoYWJpdGFzc2UgcGxhdGVhIGRpY3R1bXN0LiBEb25lYyBvZGlvIHRlbGx1cywgY29uc2VjdGV0dXIgaWQgaW1wZXJkaWV0IGluLCBzZW1wZXIgZXUgbmVxdWUuIE1hdXJpcyBmZWxpcyBlcm9zLCBoZW5kcmVyaXQgYWMgb2RpbyBxdWlzLCBldWlzbW9kIHZlc3RpYnVsdW0gbWF1cmlzLgoKRHVpcyB2ZWxpdCBtaSwgYmliZW5kdW0gaW4gbnVsbGEgbm9uLCB2ZXN0aWJ1bHVtIG1hdHRpcyBpcHN1bS4gRHVpcyBzYWdpdHRpcyBiaWJlbmR1bSBudW5jIGVnZXQgdmFyaXVzLiBFdGlhbSBvZGlvIG1pLCB0ZW1wdXMgZXUgYW50ZSB2ZWwsIGZhdWNpYnVzIGZhY2lsaXNpcyB1cm5hLiBEb25lYyBmcmluZ2lsbGEsIHF1YW0gbm9uIHBoYXJldHJhIHNjZWxlcmlzcXVlLCBuaWJoIG9kaW8gbW9sZXN0aWUgbmlzbCwgdml0YWUgYWxpcXVhbSBleCBxdWFtIG5vbiBuaWJoLiBTdXNwZW5kaXNzZSBzaXQgYW1ldCBuaXNpIGFjIHVybmEgY29uZ3VlIHN1c2NpcGl0IHZpdGFlIHZpdGFlIG5pc2kuIFN1c3BlbmRpc3NlIGFjIG1hc3NhIGNvbW1vZG8sIGRpY3R1bSB0ZWxsdXMgZXQsIG9ybmFyZSBkaWFtLiBOdWxsYSBxdWlzIGxvYm9ydGlzIGVyYXQsIHZlbCBlbGVtZW50dW0gb2Rpby4gTW9yYmkgdmVsIGVzdCB2ZWwgZWxpdCBiaWJlbmR1bSB0ZW1wdXMgYXQgdmVsIG1hdXJpcy4gTnVsbGEgbG9ib3J0aXMgZmF1Y2lidXMgbWF1cmlzIG5lYyB1bHRyaWNpZXMuIER1aXMgb3JuYXJlIHJ1dHJ1bSB0b3J0b3IsIG5lYyB2ZWhpY3VsYSBpcHN1bSBhbGlxdWV0IGVnZXQuIFZpdmFtdXMgc2l0IGFtZXQgdmFyaXVzIGZlbGlzLCBxdWlzIG1hbGVzdWFkYSBkdWkuIA==");


$servername = "mariadb";
$username = "root";
$password = "Uoc1234U";

// Create connection
$conn = mysqli_connect($servername, $username, $password);

// Check connection
if (!$conn) {
  die("Connection failed: " . mysqli_connect_error());
}

// Create database
$sqlDB = "CREATE DATABASE ISEN_NEWS";
if (mysqli_query($conn, $sqlDB)) {
  echo "Database created successfully <br/>";
} else {
  echo("Dropping DB…<br/>");
  mysqli_query($conn,"DROP DATABASE ISEN_NEWS");
  $sqlDB = "CREATE DATABASE ISEN_NEWS";
  mysqli_query($conn, $sqlDB);
  echo "Database created successfully <br/>";

}

mysqli_close($conn);

$conn2 = mysqli_connect($servername, $username, $password, 'ISEN_NEWS');

// sql to create table
$sqlTABLE_users = "CREATE TABLE users (
email VARCHAR(50),
username VARCHAR(30) NOT NULL,
password VARCHAR(30) NOT NULL,
id INT(6) NOT NULL AUTO_INCREMENT PRIMARY KEY
)";

$sqlTABLE_profiles = "CREATE TABLE profiles (
  id INT(6) NOT NULL AUTO_INCREMENT PRIMARY KEY,
  user_id INT(6) NOT NULL,
  name VARCHAR(50),
  isen_card_id VARCHAR(50),
  CONSTRAINT `fk_profile_user`
    FOREIGN KEY (user_id) REFERENCES users (id)
    ON DELETE CASCADE
    ON UPDATE RESTRICT  
  )";



$createUsers = "INSERT INTO users
(username, password, id)
VALUES 
('user', 'user1234',1),
('isen', 'isen1234',2),
('root', 'admin', 3)";




$createProfiles = "INSERT INTO profiles
(user_id, name, isen_card_id)
VALUES 
(1, 'User 1234','b54703970f774460a08b9d719b3958e5'),
(2, 'Isen 1234','61deb1b952984093a1a60b1b733dd113'),
(3, 'Super Admin', '20d4c69cd618414aa9e78fef9f0146ff')";


if (mysqli_query($conn2, $sqlTABLE_users)) {
  echo "Table Users created successfully <br/>";
} else {
  echo "Error creating table: " . mysqli_error($conn2);
  echo "<br/>";
}


if (mysqli_query($conn2, $sqlTABLE_profiles)) {
  echo "Table profiles created successfully <br/>";
} else {
  echo "Error creating table: " . mysqli_error($conn2);
}

if (mysqli_query($conn2, $createUsers) && mysqli_query($conn2, $createProfiles) ) {
  echo "Parameters added successfully <br/>";
} else {
  echo "Error while adding parameters: " . mysqli_error($conn2);
}



$sqlTABLE_News = "CREATE TABLE news (
id INT(6) NOT NULL AUTO_INCREMENT PRIMARY KEY,
title VARCHAR(30) NOT NULL,
filename VARCHAR(60) DEFAULT NULL,
content TEXT NOT NULL,
is_private BOOLEAN DEFAULT FALSE,
datetime TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
author_id INT(6) NOT NULL,
CONSTRAINT `fk_author_id`
    FOREIGN KEY (author_id) REFERENCES users (id)
    ON DELETE CASCADE
    ON UPDATE RESTRICT  
)";

$createNew1 = "INSERT INTO news
(title, content,author_id) VALUES ( 'Matinée digitale #2','$text1',1)";

$createNew2 = "INSERT INTO news
( title, content,author_id) VALUES ( 'Journée portes ouvertes','Text New 2',1)";

$createNew3 = "INSERT INTO news
(title, content,author_id) VALUES ( 'Visioconférence à l\'ISEN','Text New 3',2)";


$createNew4 = "INSERT INTO news
(id, title, content,author_id,is_private) VALUES (25, 'Prise de notes #1','Les bleuets sont bleus, les roses sont roses. <br/> Je viens de trouver un article secret.',3,True)";

if (mysqli_query($conn2, $sqlTABLE_News)) {
  echo "Table News created successfully <br/>";
} else {
  echo "Error creating table: " . mysqli_error($conn2);
}

if (mysqli_query($conn2, $createNew1) && mysqli_query($conn2, $createNew2) && mysqli_query($conn2, $createNew3) && mysqli_query($conn2, $createNew4)) {
  echo "Parameters added successfully <br/>";

} else {
  echo "Error while adding parameters: " . mysqli_error($conn2);
}

mysqli_close($conn2);
?>
